/*! program
*
* build at 2025-10-10
*/
import*as e from"/public/libs/webmodule/pagehelper.mjs";const t=new $fgta5.Application("mainapp");var a={moduleName:"program",app:t,urlDir:"public/modules/program",Crsl:new $fgta5.SectionCarousell(t.Nodes.Main),Sections:{programHeaderList:"programHeaderList-section",programHeaderEdit:"programHeaderEdit-section"},SectionMap:{"programHeaderList-section":"programHeaderList","programHeaderEdit-section":"programHeaderEdit"}};async function o(e,t){}var n=Object.freeze({__proto__:null,init:o,obj_programgroup_id_populating:function(e,t,a,o){const{tr:n,data:r}=o.detail,i=n.querySelector("td"),s=r.programgroup_level;i.style.paddingLeft=15*s+"px"}});const r=a.Crsl,i=a.Sections.programHeaderList,s=r.Items[i],d={},c=new $fgta5.Gridview("programHeaderList-tbl"),l=document.getElementById("programHeaderList-pnl_search"),u=new $fgta5.ActionButton("programHeaderList-btn_gridload"),g=s,p={};async function f(e,t){c.addEventListener("nextdata",async t=>{!async function(e,t){const a=t.detail.criteria,o=t.detail.limit,n=t.detail.nextoffset,r=t.detail.sort;await v(e,{criteria:a,limit:o,offset:n,sort:r}),c.scrollToFooter()}(e,t)}),c.addEventListener("sorting",async t=>{!function(e,t){c.clear();const a=t.detail.sort,o=t.detail.Criteria;v(e,{criteria:o,sort:a})}(e,t)});const a=n.headerList_addTableEvents;"function"==typeof a&&a(e,c),Module.isMobileDevice()?c.addEventListener("cellclick",async t=>{E(e,t)}):c.addEventListener("celldblclick",async t=>{E(e,t)}),u.addEventListener("click",async t=>{!function(e){w(e,null),m(e)}(e)});try{const t=document.querySelector('template[name="custom-search-panel"]');if(null!=t){const e=t.content.cloneNode(!0);l.prepend(e)}const a=l.querySelectorAll("[fgta5-component][binding]");for(var o of a){var r=o.getAttribute("id"),i=o.getAttribute("fgta5-component"),s=o.getAttribute("binding");p[s]=new $fgta5[i](r)}const d=document.getElementById("programHeaderList-txt_searchtext"),c=document.getElementById("programHeaderList-btn_gridload");d.addEventListener("keydown",e=>{"enter"==e.key.toLowerCase()&&(e.stopPropagation(),c.click(),d.blur())});const u=n["headerList_initSearchParams"];"function"==typeof u&&u(e,p)}catch(e){throw e}finally{!0===t.autoLoadGridData&&m(e)}}async function m(e){await c.clear(),v(e)}function y(e,t){const a=d.SelectedRow;a.previousElementSibling?t.disablePrevButton(e,!1):t.disablePrevButton(e,!0),a.nextElementSibling?t.disableNextButton(e,!1):t.disableNextButton(e,!0)}function w(e,t){d.SelectedRow=t}async function b(e,t){const a=t.getAttribute("keyvalue"),o=t.getAttribute("key"),n=e.Modules.programHeaderEdit;n.clearForm(e,"loading...");try{w(0,t),d.SelectedRow.keyValue=a,d.SelectedRow.key=o,await n.openSelectedData(e,{key:o,keyvalue:a})}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message),w(0,null),s.show()}y(e,n)}function E(e,t){const a=t.detail.tr;e.Modules.programHeaderEdit.Section.show({},t=>{b(e,a)})}async function v(e,t={}){const{criteria:o={},limit:n=0,offset:r=0,sort:i={}}=t;for(var s in p){if(!p[s].validate())return console.error("ada yang belum diisi"),!1;o[s]=p[s].value}void 0===i&&(i=c.getSort());let d=$fgta5.Modal.createMask();try{const e=await async function(e,t,o,n,r){const i=`/${a.moduleName}/header-list`;try{const e=[];return await Module.apiCall(i,{columns:e,criteria:t,offset:o,limit:n,sort:r})}catch(e){throw e}}(0,o,r,n,i);0===r&&c.clear(),c.addRows(e.data),c.setNext(e.nextoffset,e.limit)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{d.close(),d=null}}var _=Object.freeze({__proto__:null,SearchParams:p,Section:g,addNewRow:function(e,t){w(e,c.addRow(t))},getCurrentRow:function(e){return d.SelectedRow},getGrid:function(e){return c},init:f,keyboardAction:function(e,t,a){if("up"==t)c.previousRecord();else if("down"==t)c.nextRecord();else if("enter"==t){e.Modules.programHeaderEdit.Section.show({},()=>{b(e,c.CurrentRow)})}else if("typing"==t){a.preventDefault(),a.stopPropagation();const e=document.getElementById("programHeaderList-txt_searchtext"),t=a.key;e.focus(),"Backspace"==t?Module.deleteAtCursor(e,"backspace"):"Delete"==t?Module.deleteAtCursor(e,"delete"):Module.insertAtCursor(e,a.key)}},loadData:m,removeCurrentRow:function(e){const t=d.SelectedRow;c.removeRow(t)},selectNextRow:function(e){const t=d.SelectedRow;t.nextElementSibling&&(c.CurrentRow=t.nextElementSibling,b(e,t.nextElementSibling))},selectPreviousRow:function(e){const t=d.SelectedRow;t.previousElementSibling&&(c.CurrentRow=t.previousElementSibling,b(e,t.previousElementSibling))},setPagingButton:y,updateCurrentRow:function(e,t){const a=d.SelectedRow;try{c.updateRow(a,t)}catch(e){throw e}}});const h={},L=a.Crsl,M=a.Sections.programHeaderEdit,S=L.Items[M],I=a.Source,k="New Program",H="View Program",C="Edit Program",x="Edit",B="Lock",A=new $fgta5.ActionButton("programHeaderEdit-btn_edit"),$=new $fgta5.ActionButton("programHeaderEdit-btn_save"),R=new $fgta5.ActionButton("programHeaderEdit-btn_new","programHeader-new"),N=new $fgta5.ActionButton("programHeaderEdit-btn_delete"),T=new $fgta5.ActionButton("programHeaderEdit-btn_reset"),D=new $fgta5.ActionButton("programHeaderEdit-btn_prev"),P=new $fgta5.ActionButton("programHeaderEdit-btn_next"),j=document.getElementById("programHeader-btn_recordstatus"),K=document.getElementById("programHeader-btn_logs"),O=document.getElementById("programHeader-btn_about"),F=new $fgta5.Form("programHeaderEdit-frm");F.Inputs["programHeaderEdit-obj_program_id"],F.Inputs["programHeaderEdit-obj_program_isdisabled"],F.Inputs["programHeaderEdit-obj_program_name"];const U=F.Inputs["programHeaderEdit-obj_apps_id"],q=F.Inputs["programHeaderEdit-obj_programgroup_id"];F.Inputs["programHeaderEdit-obj_program_title"],F.Inputs["programHeaderEdit-obj_program_variance"],F.Inputs["programHeaderEdit-obj_program_descr"],F.Inputs["programHeaderEdit-obj_program_icon"];const V=document.getElementById("fRecord-section-createby"),G=document.getElementById("fRecord-section-createdate"),z=document.getElementById("fRecord-section-modifyby"),W=document.getElementById("fRecord-section-modifydate"),Z=S;async function J(t,o){S.addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{Y()}),F.addEventListener("locked",e=>{!async function(e){S.Title=H,A.setText(x),A.disabled=!1,$.disabled=!0,R.disabled=!1,N.disabled=!0,T.disabled=!0,D.disabled=!1,P.disabled=!1;const t=n.programHeaderEdit_formLocked;"function"==typeof t&&t(e,F,h);h.editDisabled&&(A.disabled=!0)}(t)}),F.addEventListener("unlocked",e=>{!async function(e){F.isNew()?S.Title=k:S.Title=C;A.setText(B),A.disabled=!1,$.disabled=!1,R.disabled=!0,N.disabled=!1,T.disabled=!1,D.disabled=!0,P.disabled=!0;const t=n.programHeaderEdit_formUnlocked;"function"==typeof t&&t(e,F)}(t)}),F.render(),A.addEventListener("click",e=>{!async function(){if(F.isLocked())F.lock(!1);else{if(F.isChanged()||F.isNew())return void await $fgta5.MessageBox.warning(Module.EDIT_WARNING);F.lock(!0)}}()}),$.addEventListener("click",e=>{!async function(e){const t=n.programHeaderEdit_autofill;"function"==typeof t&&await t(e,F);if(!F.validate()){const e=F.getLastError();return void $fgta5.MessageBox.warning(e)}let o;const r=F.isNew();if(r)o=F.getData();else{if(!F.isChanged())return;o=F.getDataChanged()}const i=n.programHeaderEdit_dataSaving;"function"==typeof i&&await i(e,o,F);let s=null;const d=F.getFiles();if(null!=d){s=new FormData;for(let e in d){const t=d[e];s.append(e,t)}}let c=$fgta5.Modal.createMask();try{let t;t=r?await async function(e,t,o){const n=`/${a.moduleName}/header-create`;try{return await Module.apiCall(n,{data:t,source:I},o)}catch(e){throw e}}(0,o,s):await async function(e,t,o){const n=`/${a.moduleName}/header-update`;try{return await Module.apiCall(n,{data:t,source:I},o)}catch(e){throw e}}(0,o,s);const i=F.getPrimaryInput(),d=t[i.getBindingData()],c=await X(e,d);h.currentOpenedId=d,F.AutoID?i.value=d:ee(e,{disabled:!0}),F.setData(c);const l=n["programHeaderEdit_dataSaved"];"function"==typeof l&&await l(e,c,F),F.acceptChanges(),r?(A.disabled=!1,e.Modules.programHeaderList.addNewRow(e,c)):e.Modules.programHeaderList.updateCurrentRow(e,c)}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{c.close(),c=null}}(t)}),R.addEventListener("click",e=>{!async function(e,t){const a=t.target.getAttribute("data-sectionsource"),o=e.Modules.programHeaderList,r=o.Section.Id,i=a===r;if(i)await S.show();else{let e=!1;if(F.isChanged()){"cancel"==await $fgta5.MessageBox.confirm(Module.NEWDATA_CONFIRM)&&(e=!0)}if(e)return}F.AutoID?ee(e,{disabled:!0,placeholder:"[AutoID]"}):ee(e,{disabled:!1,placeholder:"ID"});try{let t={};const a=n["programHeaderEdit_newData"];"function"==typeof a&&await a(e,t,F),await Q(e,t),F.lock(!1),A.disabled=!0,N.disabled=!0}catch(t){console.error(t),await $fgta5.MessageBox.error(t.message),i&&e.Modules.programHeaderList.Section.show()}}(t,e)}),N.addEventListener("click",e=>{!async function(e){if(F.isNew())return;const t=F.getPrimaryInput().value;if("ok"!=await $fgta5.MessageBox.confirm(Module.DELETE_CONFIRM+`id: ${t}`))return;let o=$fgta5.Modal.createMask();try{await async function(e,t){const o=`/${a.moduleName}/header-delete`;try{return await Module.apiCall(o,{id:t,source:I})}catch(e){throw e}}(0,t);e.Modules.programHeaderList.removeCurrentRow(e),e.Modules.programHeaderList.Section.show(),F.lock()}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{o.close(),o=null}}(t)}),T.addEventListener("click",e=>{!async function(){if(F.isNew())Q();else if(F.isChanged()){if("ok"!=await $fgta5.MessageBox.confirm(Module.RESET_CONFIRM))return;F.reset()}}()}),D.addEventListener("click",e=>{!async function(e){e.Modules.programHeaderList.selectPreviousRow(e)}(t)}),P.addEventListener("click",e=>{!async function(e){e.Modules.programHeaderList.selectNextRow(e)}(t)}),j.addEventListener("click",o=>{!async function(t){const o={Context:a,sectionReturn:S};e.openSection(t,"fRecord-section",o,async()=>{let e=$fgta5.Modal.createMask();try{const e=F.getPrimaryInput().value,a=await X(t,e);V.innerHTML=a._createby,G.innerHTML=a._createdate,z.innerHTML=a._modifyby,W.innerHTML=a._modifydate;const o=n["programHeaderEdit_addRecordInfo"];"function"==typeof o&&await o(t,a)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{e.close(),e=null}})}(t)}),K.addEventListener("click",o=>{!async function(t){const o={Context:a,sectionReturn:S};e.openSection(t,"fLogs-section",o,async()=>{const t=F.getPrimaryInput().value;let o=$fgta5.Modal.createMask();try{const o=`${a.appsUrls.core.url}/logs/list`,n={module:a.moduleName,table:"core.program",id:t},r=await Module.apiCall(o,{criteria:n}),i=document.getElementById("fLogs-section").querySelector("tbody");e.renderLog(i,r.data)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{o.close(),o=null}})}(t)}),O.addEventListener("click",o=>{!async function(t){const o={Context:a,sectionReturn:S};e.openSection(t,"fAbout-section",o,async()=>{L.Items["fAbout-section"].Title="About Program";const e=document.getElementById("fAbout-section");if(null==document.getElementById("fAbout-section-fdescr")){const t=document.createElement("div");t.setAttribute("id","fAbout-section-fdescr"),t.setAttribute("style","padding: 0 0 10px 0"),t.innerHTML="daftar program";const a=e.querySelector("div[data-topbar]");a.parentNode.insertBefore(t,a.nextSibling)}if(null==document.getElementById("fAbout-section-footer")){const t=document.createElement("div");t.setAttribute("id","fAbout-section-footer"),t.setAttribute("style","border-top: 1px solid #ccc; padding: 5px 0 0 0; margin-top: 50px"),t.innerHTML="This module is generated by fgta5 generator at 11 Oct 2025 04:21",e.appendChild(t)}})}(t)}),U.addEventListener("selecting",async e=>{const o=n.obj_apps_id_selecting;if("function"==typeof o)o(t,U,F,e);else{const o=e.detail.sender,i=e.detail.dialog,s=null!=e.detail.searchtext?e.detail.searchtext:"",d=`${a.appsUrls.core.url}/apps/header-list`,c={searchtext:s},l=n["obj_apps_id_selecting_criteria"];"function"==typeof l&&l(t,U,c),o.wait();try{const t=await Module.apiCall(d,{criteria:c,offset:e.detail.offset,limit:e.detail.limit});for(var r of t.data)e.detail.addRow(r.apps_id,r.apps_name,r);i.setNext(t.nextoffset,t.limit)}catch(e){$fgta5.MessageBox.error(e.message)}finally{o.wait(!1)}}}),q.addEventListener("selecting",async e=>{const o=n.obj_programgroup_id_selecting;if("function"==typeof o)o(t,q,F,e);else{const o=e.detail.sender,i=e.detail.dialog,s=null!=e.detail.searchtext?e.detail.searchtext:"",d=`${a.appsUrls.core.url}/programgroup/header-list`,c={searchtext:s},l=n["obj_programgroup_id_selecting_criteria"];"function"==typeof l&&l(t,q,c),o.wait();try{const t=await Module.apiCall(d,{criteria:c,offset:e.detail.offset,limit:e.detail.limit});for(var r of t.data)e.detail.addRow(r.programgroup_id,r.programgroup_name,r);i.setNext(t.nextoffset,t.limit)}catch(e){$fgta5.MessageBox.error(e.message)}finally{o.wait(!1)}}}),q.addEventListener("populating",e=>{const a=n.obj_programgroup_id_populating;"function"==typeof a&&a(t,q,F,e)})}async function Q(e,t){try{F.newData(t),F.acceptChanges(),F.setAsNewData()}catch(e){throw e}}async function X(e,t){const o=`/${a.moduleName}/header-open`;try{return await Module.apiCall(o,{id:t})}catch(e){throw e}}async function Y(e,t){let o=!1;F.isChanged()?"ok"==await $fgta5.MessageBox.confirm(Module.BACK_CONFIRM)&&(F.reset(),o=!0):o=!0;if(o){F.lock();const e=a.Sections.programHeaderList;L.Items[e].show({direction:1})}}async function ee(e,t){const a=F.getPrimaryInput();a.disabled=!0===t.disabled,void 0!==t.placeholder&&(a.placeholder=t.placeholder),void 0!==t.value&&(a.value=t.value)}var te=Object.freeze({__proto__:null,Section:Z,clearForm:function(e,t){F.clear(t)},disableNextButton:function(e,t=!0){P.disabled=t},disablePrevButton:function(e,t=!0){D.disabled=t},getForm:function(e){return F},getHeaderForm:function(e){return F},init:J,keyboardAction:function(e,t){"save"==t?(F.acceptInput(),$.click()):"new"==t?(F.acceptInput(),R.click()):"escape"==t?(F.acceptInput(),F.isLocked()||F.isNew()?Y():A.click()):"togleEdit"==t?(F.acceptInput(),A.click()):"right"==t?P.click():"left"==t&&D.click()},openSelectedData:async function(e,t){let a=$fgta5.Modal.createMask();try{U.clear(),q.clear();const a=t.keyvalue,o=await X(e,a);h.currentOpenedId=a;const r=n["programHeaderEdit_isEditDisabled"];if("function"==typeof r){const t=r(e,o);h.editDisabled=t}ee(e,{disabled:!0}),F.setData(o),F.acceptChanges(),F.lock();const i=n["programHeaderEdit_formOpened"];"function"==typeof i&&i(e,F,h)}catch(e){throw h.currentOpenedId=null,e}finally{a.close(),a=null}}});const ae=a.app,oe=a.Crsl;class ne extends Module{constructor(){super()}async main(e={}){ae.setTitle("Program"),ae.showFooter(!0),e.autoLoadGridData=!0;const t=this;t.Modules={programHeaderList:_,programHeaderEdit:te};try{try{const e=await Module.apiCall(`/${a.moduleName}/init`,{});a.notifierId=e.notifierId,a.notifierSocket=e.notifierSocket,a.userId=e.userId,a.userFullname=e.userFullname,a.sid=e.sid,a.appsUrls=e.appsUrls}catch(e){throw e}await Promise.all([f(t,e),J(t),o()]),await async function(e){try{const t=document.getElementsByClassName("footer-buttons-container");Module.renderFooterButtons(t),oe.setIconUrl(""),oe.addEventListener($fgta5.SectionCarousell.EVT_SECTIONSHOWING,e=>{var a=e.detail.commingSection.Id;for(let e of t){e.getAttribute("data-section")==a?setTimeout(()=>{e.classList.remove("hidden"),e.style.animation="dropped 0.3s forwards",setTimeout(()=>{e.style.animation="unset"},300)},500):e.classList.add("hidden")}}),oe.Items["fRecord-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()}),oe.Items["fLogs-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()}),oe.Items["fAbout-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()});document.getElementById("panel-detil-selector").querySelectorAll(".panel-detil-row a").forEach(t=>{t.addEventListener("mouseenter",()=>{t.closest(".panel-detil-row").classList.add("panel-detil-row-highligted")}),t.addEventListener("mouseleave",()=>{t.closest(".panel-detil-row").classList.remove("panel-detil-row-highligted")});const o=t.getAttribute("data-target-section"),n=t.getAttribute("data-current-section");t.addEventListener("click",t=>{!function(e,t,o){const n=a.Sections[o],r=oe.Items[n],i=a.Sections[t],s=oe.Items[i];s.setSectionReturn(r),s.show({},()=>{const a=e.Modules[t],n=e.Modules[o];a.openList(e,{moduleHeaderEdit:n})})}(e,o,n)})});const o=n["extendPage"];"function"==typeof o&&o(e)}catch(e){throw e}}(t),function(e){const t=/^[a-zA-Z0-9 ]$/;document.addEventListener("keydown",o=>{if(o.ctrlKey||o.metaKey||o.altKey);else if(t.test(o.key)||"Backspace"===o.key||"Delete"===o.key){const t=oe.CurrentSection.Id,n=a.SectionMap[t],r=e.Modules[n];re(e,r,"typing",o)}},!0),document.addEventListener("keydown",t=>{const o=oe.CurrentSection.Id,n=a.SectionMap[o],r=e.Modules[n],i=document.querySelector("dialog[open]");if(i)return void("escape"==t.key.toLowerCase()?(i.close(),t.preventDefault()):(t.ctrlKey||t.metaKey)&&"s"===t.key.toLowerCase()&&t.preventDefault());const s=t.key.toLowerCase();(t.ctrlKey||t.metaKey)&&"s"===s?(t.preventDefault(),re(e,r,"save",t)):(t.ctrlKey||t.metaKey)&&"n"===s||t.ctrlKey&&"f2"===s?(t.preventDefault(),re(e,r,"new",t)):"escape"===s?(t.preventDefault(),re(e,r,"escape",t)):"f2"===s?re(e,r,"togleEdit",t):"arrowup"===s?re(e,r,"up",t):"arrowdown"===s?re(e,r,"down",t):"arrowright"===s?re(e,r,"right",t):"arrowleft"===s?re(e,r,"left",t):"enter"===s&&re(e,r,"enter",t)})}(t);const r=["programHeaderEdit"];window.onbeforeunload=e=>{let a=!1;for(var o of r){t.Modules[o].getForm(t).isChanged()&&(a=a||!0)}if(a)return e.preventDefault(),"Changes you made may not be saved."}}catch(e){throw e}}}function re(e,t,a,o){null!=t?t.keyboardAction(e,a,o):"escape"==a&&oe.CurrentSection.back()}export{ne as default};
