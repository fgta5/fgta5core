/*! group
*
* build at 2025-10-10
*/
import*as e from"/public/libs/webmodule/pagehelper.mjs";const t=new $fgta5.Application("mainapp");var o={moduleName:"group",app:t,urlDir:"public/modules/group",Crsl:new $fgta5.SectionCarousell(t.Nodes.Main),Sections:{groupHeaderList:"groupHeaderList-section",groupHeaderEdit:"groupHeaderEdit-section",groupProgramList:"groupProgramList-section",groupProgramEdit:"groupProgramEdit-section"},SectionMap:{"groupHeaderList-section":"groupHeaderList","groupHeaderEdit-section":"groupHeaderEdit","groupProgramList-section":"groupProgramList","groupProgramEdit-section":"groupProgramEdit"}};async function n(e,t){}var a=Object.freeze({__proto__:null,groupHeaderEdit_dataSaved:async function(e,t,o){o.Inputs["groupHeaderEdit-obj_group_name"].disabled=!0},groupHeaderEdit_formOpened:function(e,t,o){t.Inputs["groupHeaderEdit-obj_group_name"].disabled=!0},groupHeaderEdit_newData:async function(e,t,o){o.Inputs["groupHeaderEdit-obj_group_name"].disabled=!1},init:n});const r=o.Crsl,i=o.Sections.groupHeaderList,c=r.Items[i],s={},d=new $fgta5.Gridview("groupHeaderList-tbl"),l=document.getElementById("groupHeaderList-pnl_search"),u=new $fgta5.ActionButton("groupHeaderList-btn_gridload"),g=c,f={};async function p(e,t){d.addEventListener("nextdata",async t=>{!async function(e,t){const o=t.detail.criteria,n=t.detail.limit,a=t.detail.nextoffset,r=t.detail.sort;await h(e,{criteria:o,limit:n,offset:a,sort:r}),d.scrollToFooter()}(e,t)}),d.addEventListener("sorting",async t=>{!function(e,t){d.clear();const o=t.detail.sort,n=t.detail.Criteria;h(e,{criteria:n,sort:o})}(e,t)});const o=a.headerList_addTableEvents;"function"==typeof o&&o(e,d),Module.isMobileDevice()?d.addEventListener("cellclick",async t=>{E(e,t)}):d.addEventListener("celldblclick",async t=>{E(e,t)}),u.addEventListener("click",async t=>{!function(e){w(e,null),m(e)}(e)});try{const t=document.querySelector('template[name="custom-search-panel"]');if(null!=t){const e=t.content.cloneNode(!0);l.prepend(e)}const o=l.querySelectorAll("[fgta5-component][binding]");for(var n of o){var r=n.getAttribute("id"),i=n.getAttribute("fgta5-component"),c=n.getAttribute("binding");f[c]=new $fgta5[i](r)}const s=document.getElementById("groupHeaderList-txt_searchtext"),d=document.getElementById("groupHeaderList-btn_gridload");s.addEventListener("keydown",e=>{"enter"==e.key.toLowerCase()&&(e.stopPropagation(),d.click(),s.blur())});const u=a["headerList_initSearchParams"];"function"==typeof u&&u(e,f)}catch(e){throw e}finally{!0===t.autoLoadGridData&&m(e)}}async function m(e){await d.clear(),h(e)}function y(e,t){const o=s.SelectedRow;o.previousElementSibling?t.disablePrevButton(e,!1):t.disablePrevButton(e,!0),o.nextElementSibling?t.disableNextButton(e,!1):t.disableNextButton(e,!0)}function w(e,t){s.SelectedRow=t}async function b(e,t){const o=t.getAttribute("keyvalue"),n=t.getAttribute("key"),a=e.Modules.groupHeaderEdit;a.clearForm(e,"loading...");try{w(0,t),s.SelectedRow.keyValue=o,s.SelectedRow.key=n,await a.openSelectedData(e,{key:n,keyvalue:o})}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message),w(0,null),c.show()}y(e,a)}function E(e,t){const o=t.detail.tr;e.Modules.groupHeaderEdit.Section.show({},t=>{b(e,o)})}async function h(e,t={}){const{criteria:n={},limit:a=0,offset:r=0,sort:i={}}=t;for(var c in f){if(!f[c].validate())return console.error("ada yang belum diisi"),!1;n[c]=f[c].value}void 0===i&&(i=d.getSort());let s=$fgta5.Modal.createMask();try{const e=await async function(e,t,n,a,r){const i=`/${o.moduleName}/header-list`;try{const e=[];return await Module.apiCall(i,{columns:e,criteria:t,offset:n,limit:a,sort:r})}catch(e){throw e}}(0,n,r,a,i);0===r&&d.clear(),d.addRows(e.data),d.setNext(e.nextoffset,e.limit)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{s.close(),s=null}}var v=Object.freeze({__proto__:null,SearchParams:f,Section:g,addNewRow:function(e,t){w(e,d.addRow(t))},getCurrentRow:function(e){return s.SelectedRow},getGrid:function(e){return d},init:p,keyboardAction:function(e,t,o){if("up"==t)d.previousRecord();else if("down"==t)d.nextRecord();else if("enter"==t){e.Modules.groupHeaderEdit.Section.show({},()=>{b(e,d.CurrentRow)})}else if("typing"==t){o.preventDefault(),o.stopPropagation();const e=document.getElementById("groupHeaderList-txt_searchtext"),t=o.key;e.focus(),"Backspace"==t?Module.deleteAtCursor(e,"backspace"):"Delete"==t?Module.deleteAtCursor(e,"delete"):Module.insertAtCursor(e,o.key)}},loadData:m,removeCurrentRow:function(e){const t=s.SelectedRow;d.removeRow(t)},selectNextRow:function(e){const t=s.SelectedRow;t.nextElementSibling&&(d.CurrentRow=t.nextElementSibling,b(e,t.nextElementSibling))},selectPreviousRow:function(e){const t=s.SelectedRow;t.previousElementSibling&&(d.CurrentRow=t.previousElementSibling,b(e,t.previousElementSibling))},setPagingButton:y,updateCurrentRow:function(e,t){const o=s.SelectedRow;try{d.updateRow(o,t)}catch(e){throw e}}});const L={},M=o.Crsl,k=o.Sections.groupHeaderEdit,_=M.Items[k],S=o.Source,I="New Group",C="View Group",B="Edit Group",R="Edit",$="Lock",P=new $fgta5.ActionButton("groupHeaderEdit-btn_edit"),x=new $fgta5.ActionButton("groupHeaderEdit-btn_save"),H=new $fgta5.ActionButton("groupHeaderEdit-btn_new","groupHeader-new"),A=new $fgta5.ActionButton("groupHeaderEdit-btn_delete"),N=new $fgta5.ActionButton("groupHeaderEdit-btn_reset"),D=new $fgta5.ActionButton("groupHeaderEdit-btn_prev"),T=new $fgta5.ActionButton("groupHeaderEdit-btn_next"),F=document.getElementById("groupHeader-btn_recordstatus"),O=document.getElementById("groupHeader-btn_logs"),K=document.getElementById("groupHeader-btn_about"),j=new $fgta5.Form("groupHeaderEdit-frm");j.Inputs["groupHeaderEdit-obj_group_id"],j.Inputs["groupHeaderEdit-obj_group_name"],j.Inputs["groupHeaderEdit-obj_group_descr"],j.Inputs["groupHeaderEdit-obj_group_isdisabled"];const U=document.getElementById("fRecord-section-createby"),G=document.getElementById("fRecord-section-createdate"),V=document.getElementById("fRecord-section-modifyby"),q=document.getElementById("fRecord-section-modifydate"),z=_;async function W(t,n){_.addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{Q()}),j.addEventListener("locked",e=>{!async function(e){_.Title=C,P.setText(R),P.disabled=!1,x.disabled=!0,H.disabled=!1,A.disabled=!0,N.disabled=!0,D.disabled=!1,T.disabled=!1;const t=a.groupHeaderEdit_formLocked;"function"==typeof t&&t(e,j,L);L.editDisabled&&(P.disabled=!0);e.Modules.groupProgramList.headerLocked(e),e.Modules.groupProgramEdit.headerLocked(e)}(t)}),j.addEventListener("unlocked",e=>{!async function(e){j.isNew()?_.Title=I:_.Title=B;P.setText($),P.disabled=!1,x.disabled=!1,H.disabled=!0,A.disabled=!1,N.disabled=!1,D.disabled=!0,T.disabled=!0;const t=a.groupHeaderEdit_formUnlocked;"function"==typeof t&&t(e,j);e.Modules.groupProgramList.headerUnlocked(e),e.Modules.groupProgramEdit.headerUnlocked(e)}(t)}),j.render(),P.addEventListener("click",e=>{!async function(){if(j.isLocked())j.lock(!1);else{if(j.isChanged()||j.isNew())return void await $fgta5.MessageBox.warning(Module.EDIT_WARNING);j.lock(!0)}}()}),x.addEventListener("click",e=>{!async function(e){const t=a.groupHeaderEdit_autofill;"function"==typeof t&&await t(e,j);if(!j.validate()){const e=j.getLastError();return void $fgta5.MessageBox.warning(e)}let n;const r=j.isNew();if(r)n=j.getData();else{if(!j.isChanged())return;n=j.getDataChanged()}const i=a.groupHeaderEdit_dataSaving;"function"==typeof i&&await i(e,n,j);let c=null;const s=j.getFiles();if(null!=s){c=new FormData;for(let e in s){const t=s[e];c.append(e,t)}}let d=$fgta5.Modal.createMask();try{let t;t=r?await async function(e,t,n){const a=`/${o.moduleName}/header-create`;try{return await Module.apiCall(a,{data:t,source:S},n)}catch(e){throw e}}(0,n,c):await async function(e,t,n){const a=`/${o.moduleName}/header-update`;try{return await Module.apiCall(a,{data:t,source:S},n)}catch(e){throw e}}(0,n,c);const i=j.getPrimaryInput(),s=t[i.getBindingData()],d=await J(e,s);L.currentOpenedId=s,j.AutoID?i.value=s:X(e,{disabled:!0}),j.setData(d);const l=a["groupHeaderEdit_dataSaved"];"function"==typeof l&&await l(e,d,j),j.acceptChanges(),r?(P.disabled=!1,e.Modules.groupHeaderList.addNewRow(e,d)):e.Modules.groupHeaderList.updateCurrentRow(e,d)}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{d.close(),d=null}}(t)}),H.addEventListener("click",e=>{!async function(e,t){const o=t.target.getAttribute("data-sectionsource"),n=e.Modules.groupHeaderList,r=n.Section.Id,i=o===r;if(i)await _.show();else{let e=!1;if(j.isChanged()){"cancel"==await $fgta5.MessageBox.confirm(Module.NEWDATA_CONFIRM)&&(e=!0)}if(e)return}j.AutoID?X(e,{disabled:!0,placeholder:"[AutoID]"}):X(e,{disabled:!1,placeholder:"ID"});try{let t={};const o=a["groupHeaderEdit_newData"];"function"==typeof o&&await o(e,t,j),await Z(e,t),j.lock(!1),P.disabled=!0,A.disabled=!0}catch(t){console.error(t),await $fgta5.MessageBox.error(t.message),i&&e.Modules.groupHeaderList.Section.show()}}(t,e)}),A.addEventListener("click",e=>{!async function(e){if(j.isNew())return;const t=j.getPrimaryInput().value;if("ok"!=await $fgta5.MessageBox.confirm(Module.DELETE_CONFIRM+`id: ${t}`))return;let n=$fgta5.Modal.createMask();try{await async function(e,t){const n=`/${o.moduleName}/header-delete`;try{return await Module.apiCall(n,{id:t,source:S})}catch(e){throw e}}(0,t);e.Modules.groupHeaderList.removeCurrentRow(e),e.Modules.groupHeaderList.Section.show(),j.lock()}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{n.close(),n=null}}(t)}),N.addEventListener("click",e=>{!async function(){if(j.isNew())Z();else if(j.isChanged()){if("ok"!=await $fgta5.MessageBox.confirm(Module.RESET_CONFIRM))return;j.reset()}}()}),D.addEventListener("click",e=>{!async function(e){e.Modules.groupHeaderList.selectPreviousRow(e)}(t)}),T.addEventListener("click",e=>{!async function(e){e.Modules.groupHeaderList.selectNextRow(e)}(t)}),F.addEventListener("click",n=>{!async function(t){const n={Context:o,sectionReturn:_};e.openSection(t,"fRecord-section",n,async()=>{let e=$fgta5.Modal.createMask();try{const e=j.getPrimaryInput().value,o=await J(t,e);U.innerHTML=o._createby,G.innerHTML=o._createdate,V.innerHTML=o._modifyby,q.innerHTML=o._modifydate;const n=a["groupHeaderEdit_addRecordInfo"];"function"==typeof n&&await n(t,o)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{e.close(),e=null}})}(t)}),O.addEventListener("click",n=>{!async function(t){const n={Context:o,sectionReturn:_};e.openSection(t,"fLogs-section",n,async()=>{const t=j.getPrimaryInput().value;let n=$fgta5.Modal.createMask();try{const n=`${o.appsUrls.core.url}/logs/list`,a={module:o.moduleName,table:"core.group",id:t},r=await Module.apiCall(n,{criteria:a}),i=document.getElementById("fLogs-section").querySelector("tbody");e.renderLog(i,r.data)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{n.close(),n=null}})}(t)}),K.addEventListener("click",n=>{!async function(t){const n={Context:o,sectionReturn:_};e.openSection(t,"fAbout-section",n,async()=>{M.Items["fAbout-section"].Title="About Group";const e=document.getElementById("fAbout-section");if(null==document.getElementById("fAbout-section-fdescr")){const t=document.createElement("div");t.setAttribute("id","fAbout-section-fdescr"),t.setAttribute("style","padding: 0 0 10px 0"),t.innerHTML="group";const o=e.querySelector("div[data-topbar]");o.parentNode.insertBefore(t,o.nextSibling)}if(null==document.getElementById("fAbout-section-footer")){const t=document.createElement("div");t.setAttribute("id","fAbout-section-footer"),t.setAttribute("style","border-top: 1px solid #ccc; padding: 5px 0 0 0; margin-top: 50px"),t.innerHTML="This module is generated by fgta5 generator at 11 Oct 2025 04:22",e.appendChild(t)}})}(t)})}async function Z(e,t){try{j.newData(t),j.acceptChanges(),j.setAsNewData()}catch(e){throw e}}async function J(e,t){const n=`/${o.moduleName}/header-open`;try{return await Module.apiCall(n,{id:t})}catch(e){throw e}}async function Q(e,t){let n=!1;j.isChanged()?"ok"==await $fgta5.MessageBox.confirm(Module.BACK_CONFIRM)&&(j.reset(),n=!0):n=!0;if(n){j.lock();const e=o.Sections.groupHeaderList;M.Items[e].show({direction:1})}}async function X(e,t){const o=j.getPrimaryInput();o.disabled=!0===t.disabled,void 0!==t.placeholder&&(o.placeholder=t.placeholder),void 0!==t.value&&(o.value=t.value)}var Y=Object.freeze({__proto__:null,Section:z,clearForm:function(e,t){j.clear(t)},disableNextButton:function(e,t=!0){T.disabled=t},disablePrevButton:function(e,t=!0){D.disabled=t},getForm:function(e){return j},getHeaderForm:function(e){return j},init:W,keyboardAction:function(e,t){"save"==t?(j.acceptInput(),x.click()):"new"==t?(j.acceptInput(),H.click()):"escape"==t?(j.acceptInput(),j.isLocked()||j.isNew()?Q():P.click()):"togleEdit"==t?(j.acceptInput(),P.click()):"right"==t?T.click():"left"==t&&D.click()},openSelectedData:async function(e,t){let o=$fgta5.Modal.createMask();try{const o=t.keyvalue,n=await J(e,o);L.currentOpenedId=o;const r=a["groupHeaderEdit_isEditDisabled"];if("function"==typeof r){const t=r(e,n);L.editDisabled=t}X(e,{disabled:!0}),j.setData(n),j.acceptChanges(),j.lock();const i=a["groupHeaderEdit_formOpened"];"function"==typeof i&&i(e,j,L)}catch(e){throw L.currentOpenedId=null,e}finally{o.close(),o=null}}});const ee=o.Crsl,te=o.Sections.groupProgramList,oe=ee.Items[te],ne={},ae=new $fgta5.Gridview("groupProgramList-tbl"),re=document.getElementById("groupProgramList-btn_addrow"),ie=new $fgta5.ActionButton("groupProgramList-btn_delrow");let ce;const se=oe;async function de(e,t){oe.addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{const t=o.Sections.groupHeaderEdit;ee.Items[t].show({direction:1})}),ae.addEventListener("nextdata",async t=>{!async function(e,t){const o=t.detail.criteria,n=t.detail.limit,a=t.detail.nextoffset,r=t.detail.sort;await pe(e,{criteria:o,limit:n,offset:a,sort:r}),ae.scrollToFooter()}(e,t)}),ae.addEventListener("sorting",async t=>{!async function(e,t){ae.clear();const o=t.detail.sort,n=t.detail.Criteria;pe(e,{criteria:n,sort:o})}(e,t)});const n=a.programList_addTableEvents;"function"==typeof n&&n(e,ae),Module.isMobileDevice()?ae.addEventListener("cellclick",async t=>{fe(e,t)}):ae.addEventListener("celldblclick",async t=>{fe(e,t)}),ie.addEventListener("click",e=>{!async function(){const e=ae.getSelected();if(0==e.length)return;if("ok"!=await $fgta5.MessageBox.confirm(`Apakah anda yakin akan menghappus ${e.length} data yang dipilih?`))return;let t=$fgta5.Modal.createMask();try{await async function(e,t){const n=`/${o.moduleName}/program-delete-rows`;try{const e=await Module.apiCall(n,{data:t});if(e.deleted)return!0;throw new Error(e.message)}catch(e){throw e}}(0,e)&&ae.removeSelected()}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{t.close(),t=null}}()});const r=a.groupProgramList_init;"function"==typeof r&&r(e),ne.headerFormLocked=!0}function le(e,t){const o=ne.SelectedRow;o.previousElementSibling?t.disablePrevButton(e,!1):t.disablePrevButton(e,!0),o.nextElementSibling?t.disableNextButton(e,!1):t.disableNextButton(e,!0)}function ue(e,t){ne.SelectedRow=t}async function ge(e,t){const o=t.getAttribute("keyvalue"),n=t.getAttribute("key"),a=e.Modules.groupProgramEdit;a.clearForm(e,"loading...");try{ue(0,t),ne.SelectedRow.keyValue=o,ne.SelectedRow.key=n,await a.openSelectedData(e,{key:n,keyvalue:o})}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message),ue(0,null),oe.show()}le(e,a)}async function fe(e,t){const o=t.detail.tr;e.Modules.groupProgramEdit.Section.show({},t=>{ge(e,o)})}async function pe(e,t={}){const{criteria:n={},limit:a=0,offset:r=0,sort:i={}}=t;let c=$fgta5.Modal.createMask();try{const e=await async function(e,t,n,a,r){const i=`/${o.moduleName}/program-list`;try{const e=[];return await Module.apiCall(i,{columns:e,criteria:t,offset:n,limit:a,sort:r})}catch(e){throw e}}(0,n,r,a,i);0===r&&ae.clear(),ae.addRows(e.data),ae.setNext(e.nextoffset,e.limit)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{c.close(),c=null}}var me=Object.freeze({__proto__:null,Section:se,addNewRow:function(e,t){ue(e,ae.addRow(t))},getCurrentRow:function(e){return ne.SelectedRow},getGrid:function(e){return ae},headerLocked:function(e){ne.headerFormLocked=!0},headerUnlocked:function(e){ne.headerFormLocked=!1},init:de,keyboardAction:function(e,t){if("up"==t)ae.previousRecord();else if("down"==t)ae.nextRecord();else if("enter"==t){e.Modules.groupProgramEdit.Section.show({},t=>{ge(e,ae.CurrentRow)})}},openList:async function(e,t){const o=t.moduleHeaderEdit;ce=o.getHeaderForm();const n=ce.getPrimaryInput().value,r=a.groupProgramList_openList;"function"==typeof r&&r(e,ce);const i={group_id:n},c=ae.getSort();ae.clear(),pe(e,{criteria:i,sort:c}),ne.headerFormLocked?(re.setAttribute("disabled",""),ie.disabled=!0):(re.removeAttribute("disabled"),ie.disabled=!1)},removeCurrentRow:function(e){const t=ne.SelectedRow;ae.removeRow(t)},selectNextRow:function(e){const t=ne.SelectedRow;t.nextElementSibling&&(ae.CurrentRow=t.nextElementSibling,ge(e,t.nextElementSibling))},selectPreviousRow:function(e){const t=ne.SelectedRow;t.previousElementSibling&&(ae.CurrentRow=t.previousElementSibling,ge(e,t.previousElementSibling))},setPagingButton:le,updateCurrentRow:function(e,t){const o=ne.SelectedRow;try{ae.updateRow(o,t)}catch(e){throw e}}});const ye={},we=o.Crsl,be=o.Sections.groupProgramEdit,Ee=we.Items[be],he=o.Source,ve="New Group",Le="View Group",Me="Edit Group",ke="Edit",_e="Lock",Se=new $fgta5.ActionButton("groupProgramEdit-btn_edit"),Ie=new $fgta5.ActionButton("groupProgramEdit-btn_save"),Ce=new $fgta5.ActionButton("groupProgramEdit-btn_new","groupProgram-addrow"),Be=new $fgta5.ActionButton("groupProgramEdit-btn_delete","groupProgram-delrow"),Re=new $fgta5.ActionButton("groupProgramEdit-btn_reset"),$e=new $fgta5.ActionButton("groupProgramEdit-btn_prev"),Pe=new $fgta5.ActionButton("groupProgramEdit-btn_next"),xe=document.getElementById("groupProgram-btn_recordstatus"),He=document.getElementById("groupProgram-btn_logs"),Ae=new $fgta5.Form("groupProgramEdit-frm");Ae.Inputs["groupProgramEdit-obj_groupprogram_id"];const Ne=Ae.Inputs["groupProgramEdit-obj_program_id"];Ae.Inputs["groupProgramEdit-obj_groupprogram_isdisabled"],Ae.Inputs["groupProgramEdit-obj_group_id"];const De=document.getElementById("fRecord-section-createby"),Te=document.getElementById("fRecord-section-createdate"),Fe=document.getElementById("fRecord-section-modifyby"),Oe=document.getElementById("fRecord-section-modifydate"),Ke=Ee;async function je(t,n){Ee.addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{Ve()}),Ae.addEventListener("locked",e=>{!async function(e){Ee.Title=Le,Se.setText(ke),Se.disabled=!1,Ie.disabled=!0,Ce.disabled=!1,Be.disabled=!0,Re.disabled=!0,$e.disabled=!1,Pe.disabled=!1;const t=a.groupProgramEdit_formLocked;"function"==typeof t&&t(e,Ae,ye);ye.editDisabled&&(Se.disabled=!0,Ce.disabled=!0)}(t)}),Ae.addEventListener("unlocked",e=>{!async function(e){Ae.isNew()?Ee.Title=ve:Ee.Title=Me;Se.setText(_e),Se.disabled=!1,Ie.disabled=!1,Ce.disabled=!0,Be.disabled=!1,Re.disabled=!1,$e.disabled=!0,Pe.disabled=!0;const t=a.groupProgramEdit_formUnlocked;"function"==typeof t&&t(e,Ae)}(t)}),Ae.render(),Se.addEventListener("click",e=>{!async function(){if(Ae.isLocked())Ae.lock(!1);else{if(Ae.isChanged()||Ae.isNew())return void await $fgta5.MessageBox.warning(Module.EDIT_WARNING);Ae.lock(!0)}}()}),Ie.addEventListener("click",e=>{!async function(e){const t=a.groupProgramEdit_autofill;"function"==typeof t&&await t(e,Ae);if(!Ae.validate()){const e=Ae.getLastError();return void $fgta5.MessageBox.warning(e)}let n;const r=Ae.isNew();if(r)n=Ae.getData();else{if(!Ae.isChanged())return;n=Ae.getDataChanged()}let i=null;const c=Ae.getFiles();if(null!=c){i=new FormData;for(let e in c){const t=c[e];i.append(e,t)}}const s=a.groupProgramEdit_dataSaving;"function"==typeof s&&await s(e,n,Ae);let d=$fgta5.Modal.createMask();try{let t;t=r?await async function(e,t,n){const a=`/${o.moduleName}/program-create`;try{return await Module.apiCall(a,{data:t,source:he},n)}catch(e){throw e}}(0,n,i):await async function(e,t,n){const a=`/${o.moduleName}/program-update`;try{return await Module.apiCall(a,{data:t,source:he},n)}catch(e){throw e}}(0,n,i);const c=Ae.getPrimaryInput(),s=t[c.getBindingData()],d=await Ge(e,s);ye.currentOpenedId=s,Ae.AutoID?c.value=s:qe(e,{disabled:!0}),Ae.setData(d);const l=a["groupProgramEdit_dataSaved"];"function"==typeof l&&await l(e,d,Ae),Ae.acceptChanges(),r?(Se.disabled=!1,e.Modules.groupProgramList.addNewRow(e,d)):e.Modules.groupProgramList.updateCurrentRow(e,d)}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{d.close(),d=null}}(t)}),Ce.addEventListener("click",e=>{!async function(e,t){const o=t.target.getAttribute("data-sectionsource"),n=e.Modules.groupProgramList,r=n.Section.Id,i=o===r;if(i)Ee.setSectionReturn(n.Section),await Ee.show();else{let e=!1;if(Ae.isChanged()){"cancel"==await $fgta5.MessageBox.confirm(Module.NEWDATA_CONFIRM)&&(e=!0)}if(e)return}Ae.AutoID?qe(e,{disabled:!0,placeholder:"[AutoID]"}):qe(e,{disabled:!1,placeholder:"ID"});try{const t=e.Modules.groupHeaderEdit,o=t.getHeaderForm().getPrimaryInput();let n={group_id:o.value};const r=a["groupProgramEdit_newData"];"function"==typeof r&&await r(e,n,Ae),await Ue(e,n),Ae.lock(!1),Se.disabled=!0,Be.disabled=!0}catch(t){console.error(t),await $fgta5.MessageBox.error(t.message),i&&e.Modules.groupProgramList.Section.show()}}(t,e)}),Be.addEventListener("click",e=>{!async function(e){if(Ae.isNew())return;const t=Ae.getPrimaryInput().value;if("ok"!=await $fgta5.MessageBox.confirm(Module.DELETE_CONFIRM+`id: ${t}`))return;let n=$fgta5.Modal.createMask();try{await async function(e,t){const n=`/${o.moduleName}/program-delete`;try{return await Module.apiCall(n,{id:t,source:he})}catch(e){throw e}}(0,t);e.Modules.groupProgramList.removeCurrentRow(e),e.Modules.groupProgramList.Section.show(),Ae.lock()}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{n.close(),n=null}}(t)}),Re.addEventListener("click",e=>{!async function(){if(Ae.isNew())Ue();else if(Ae.isChanged()){if("ok"!=await $fgta5.MessageBox.confirm(Module.RESET_CONFIRM))return;Ae.reset()}}()}),$e.addEventListener("click",e=>{!async function(e){e.Modules.groupProgramList.selectPreviousRow(e)}(t)}),Pe.addEventListener("click",e=>{!async function(e){e.Modules.groupProgramList.selectNextRow(e)}(t)}),xe.addEventListener("click",n=>{!async function(t){const n={Context:o,sectionReturn:Ee};e.openSection(t,"fRecord-section",n,async()=>{let e=$fgta5.Modal.createMask();try{const e=Ae.getPrimaryInput().value,o=await Ge(t,e);De.innerHTML=o._createby,Te.innerHTML=o._createdate,Fe.innerHTML=o._modifyby,Oe.innerHTML=o._modifydate;const n=a["groupProgramEdit_addRecordInfo"];"function"==typeof n&&await n(t,o)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{e.close(),e=null}})}(t)}),He.addEventListener("click",n=>{!async function(t){const n={Context:o,sectionReturn:Ee};e.openSection(t,"fLogs-section",n,async()=>{const t=Ae.getPrimaryInput().value;let n=$fgta5.Modal.createMask();try{const n=`${o.appsUrls.core.url}/logs/list`,a={module:o.moduleName,table:"core.groupprogram",id:t},r=await Module.apiCall(n,{criteria:a}),i=document.getElementById("fLogs-section").querySelector("tbody");e.renderLog(i,r.data)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{n.close(),n=null}})}(t)}),ye.headerFormLocked=!0,ye.editDisabled=!1,Ne.addEventListener("selecting",async e=>{if("function"==typeof fn_obj_program_id_selecting)fn_obj_program_id_selecting(t,Ne,Ae,e);else{const r=e.detail.sender,i=e.detail.dialog,c=null!=e.detail.searchtext?e.detail.searchtext:"",s=`${o.appsUrls.core.url}/program/header-list`,d={searchtext:c},l=a["obj_program_id_selecting_criteria"];"function"==typeof fn_selecting_criteria&&l(t,Ne,d),r.wait();try{const t=await Module.apiCall(s,{criteria:d,offset:e.detail.offset,limit:e.detail.limit});for(var n of t.data)e.detail.addRow(n.program_id,n.program_name,n);i.setNext(t.nextoffset,t.limit)}catch(e){$fgta5.MessageBox.error(e.message)}finally{r.wait(!1)}}})}async function Ue(e,t){try{Ae.newData(t),Ae.acceptChanges(),Ae.setAsNewData()}catch(e){throw e}}async function Ge(e,t){const n=`/${o.moduleName}/program-open`;try{return await Module.apiCall(n,{id:t})}catch(e){throw e}}async function Ve(e,t){let n=!1;Ae.isChanged()?"ok"==await $fgta5.MessageBox.confirm(Module.BACK_CONFIRM)&&(Ae.reset(),n=!0):n=!0;if(n){Ae.lock();const e=o.Sections.groupProgramList;we.Items[e].show({direction:1})}}async function qe(e,t){const o=Ae.getPrimaryInput();o.disabled=!0===t.disabled,void 0!==t.placeholder&&(o.placeholder=t.placeholder),void 0!==t.value&&(o.value=t.value)}var ze=Object.freeze({__proto__:null,Section:Ke,clearForm:function(e,t){Ae.clear(t)},disableNextButton:function(e,t=!0){Pe.disabled=t},disablePrevButton:function(e,t=!0){$e.disabled=t},getForm:function(e){return Ae},headerLocked:function(e){ye.headerFormLocked=!0,ye.editDisabled=!0,Ce.disabled=!0},headerUnlocked:function(e){ye.headerFormLocked=!1,ye.editDisabled=!1,Ce.disabled=!1},init:je,keyboardAction:function(e,t){"save"==t?(Ae.acceptInput(),Ie.click()):"new"==t?(Ae.acceptInput(),Ce.click()):"escape"==t?(Ae.acceptInput(),Ae.isLocked()||Ae.isNew()?Ve():Se.click()):"togleEdit"==t?(Ae.acceptInput(),Se.click()):"right"==t?Pe.click():"left"==t&&$e.click()},openSelectedData:async function(e,t){let o=$fgta5.Modal.createMask();try{Ne.clear();const o=t.keyvalue,n=await Ge(e,o);if(ye.currentOpenedId=o,!ye.headerFormLocked){const t=a["groupProgramEdit_isEditDisabled"];if("function"==typeof t){const o=t(e,n);ye.editDisabled=o}}qe(e,{disabled:!0}),Ae.setData(n),Ae.acceptChanges(),Ae.lock();const r=a["groupProgramEdit_formOpened"];"function"==typeof r&&r(e,Ae,ye)}catch(e){throw ye.currentOpenedId=null,e}finally{o.close(),o=null}}});const We=o.app,Ze=o.Crsl;class Je extends Module{constructor(){super()}async main(e={}){We.setTitle("Group"),We.showFooter(!0),e.autoLoadGridData=!0;const t=this;t.Modules={groupHeaderList:v,groupHeaderEdit:Y,groupProgramList:me,groupProgramEdit:ze};try{try{const e=await Module.apiCall(`/${o.moduleName}/init`,{});o.notifierId=e.notifierId,o.notifierSocket=e.notifierSocket,o.userId=e.userId,o.userFullname=e.userFullname,o.sid=e.sid,o.appsUrls=e.appsUrls}catch(e){throw e}await Promise.all([p(t,e),W(t),de(t),je(t),n()]),await async function(e){try{const t=document.getElementsByClassName("footer-buttons-container");Module.renderFooterButtons(t),Ze.setIconUrl(""),Ze.addEventListener($fgta5.SectionCarousell.EVT_SECTIONSHOWING,e=>{var o=e.detail.commingSection.Id;for(let e of t){e.getAttribute("data-section")==o?setTimeout(()=>{e.classList.remove("hidden"),e.style.animation="dropped 0.3s forwards",setTimeout(()=>{e.style.animation="unset"},300)},500):e.classList.add("hidden")}}),Ze.Items["fRecord-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()}),Ze.Items["fLogs-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()}),Ze.Items["fAbout-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()});document.getElementById("panel-detil-selector").querySelectorAll(".panel-detil-row a").forEach(t=>{t.addEventListener("mouseenter",()=>{t.closest(".panel-detil-row").classList.add("panel-detil-row-highligted")}),t.addEventListener("mouseleave",()=>{t.closest(".panel-detil-row").classList.remove("panel-detil-row-highligted")});const n=t.getAttribute("data-target-section"),a=t.getAttribute("data-current-section");t.addEventListener("click",t=>{!function(e,t,n){const a=o.Sections[n],r=Ze.Items[a],i=o.Sections[t],c=Ze.Items[i];c.setSectionReturn(r),c.show({},()=>{const o=e.Modules[t],a=e.Modules[n];o.openList(e,{moduleHeaderEdit:a})})}(e,n,a)})});const n=a["extendPage"];"function"==typeof n&&n(e)}catch(e){throw e}}(t),function(e){const t=/^[a-zA-Z0-9 ]$/;document.addEventListener("keydown",n=>{if(n.ctrlKey||n.metaKey||n.altKey);else if(t.test(n.key)||"Backspace"===n.key||"Delete"===n.key){const t=Ze.CurrentSection.Id,a=o.SectionMap[t],r=e.Modules[a];Qe(e,r,"typing",n)}},!0),document.addEventListener("keydown",t=>{const n=Ze.CurrentSection.Id,a=o.SectionMap[n],r=e.Modules[a],i=document.querySelector("dialog[open]");if(i)return void("escape"==t.key.toLowerCase()?(i.close(),t.preventDefault()):(t.ctrlKey||t.metaKey)&&"s"===t.key.toLowerCase()&&t.preventDefault());const c=t.key.toLowerCase();(t.ctrlKey||t.metaKey)&&"s"===c?(t.preventDefault(),Qe(e,r,"save",t)):(t.ctrlKey||t.metaKey)&&"n"===c||t.ctrlKey&&"f2"===c?(t.preventDefault(),Qe(e,r,"new",t)):"escape"===c?(t.preventDefault(),Qe(e,r,"escape",t)):"f2"===c?Qe(e,r,"togleEdit",t):"arrowup"===c?Qe(e,r,"up",t):"arrowdown"===c?Qe(e,r,"down",t):"arrowright"===c?Qe(e,r,"right",t):"arrowleft"===c?Qe(e,r,"left",t):"enter"===c&&Qe(e,r,"enter",t)})}(t);const r=["groupHeaderEdit","groupProgramEdit"];window.onbeforeunload=e=>{let o=!1;for(var n of r){t.Modules[n].getForm(t).isChanged()&&(o=o||!0)}if(o)return e.preventDefault(),"Changes you made may not be saved."}}catch(e){throw e}}}function Qe(e,t,o,n){null!=t?t.keyboardAction(e,o,n):"escape"==o&&Ze.CurrentSection.back()}export{Je as default};
