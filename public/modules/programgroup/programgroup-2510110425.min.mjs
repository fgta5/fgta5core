/*! programgroup
*
* build at 2025-10-10
*/
import*as e from"/public/libs/webmodule/pagehelper.mjs";const t=new $fgta5.Application("mainapp");var o={moduleName:"programgroup",app:t,urlDir:"public/modules/programgroup",Crsl:new $fgta5.SectionCarousell(t.Nodes.Main),Sections:{programgroupHeaderList:"programgroupHeaderList-section",programgroupHeaderEdit:"programgroupHeaderEdit-section"},SectionMap:{"programgroupHeaderList-section":"programgroupHeaderList","programgroupHeaderEdit-section":"programgroupHeaderEdit"}};async function r(e,t){}var a=Object.freeze({__proto__:null,headerList_addTableEvents:function(e,t){t.addEventListener("rowrender",async e=>{!function(e,t){const o=t.detail.tr,r=o.querySelector('td[data-name="programgroup_level"]'),a=o.querySelector('td[data-name="programgroup_name"]'),n=Number(r.getAttribute("data-value"));if(a.innerHTML,n>1){const e=30*(n-1);a.style.paddingLeft=`${e}px`}}(0,e)})},init:r,obj_programgroup_parent_selecting_criteria:function(e,t,o){o.programgroup_isparent=!0,o.exclude_self=t.value}});const n=o.Crsl,i=o.Sections.programgroupHeaderList,s=n.Items[i],c={},d=new $fgta5.Gridview("programgroupHeaderList-tbl"),l=document.getElementById("programgroupHeaderList-pnl_search"),u=new $fgta5.ActionButton("programgroupHeaderList-btn_gridload"),g=s,p={};async function m(e,t){d.addEventListener("nextdata",async t=>{!async function(e,t){const o=t.detail.criteria,r=t.detail.limit,a=t.detail.nextoffset,n=t.detail.sort;await v(e,{criteria:o,limit:r,offset:a,sort:n}),d.scrollToFooter()}(e,t)}),d.addEventListener("sorting",async t=>{!function(e,t){d.clear();const o=t.detail.sort,r=t.detail.Criteria;v(e,{criteria:r,sort:o})}(e,t)});const o=a.headerList_addTableEvents;"function"==typeof o&&o(e,d),Module.isMobileDevice()?d.addEventListener("cellclick",async t=>{E(e,t)}):d.addEventListener("celldblclick",async t=>{E(e,t)}),u.addEventListener("click",async t=>{!function(e){w(e,null),f(e)}(e)});try{const t=document.querySelector('template[name="custom-search-panel"]');if(null!=t){const e=t.content.cloneNode(!0);l.prepend(e)}const o=l.querySelectorAll("[fgta5-component][binding]");for(var r of o){var n=r.getAttribute("id"),i=r.getAttribute("fgta5-component"),s=r.getAttribute("binding");p[s]=new $fgta5[i](n)}const c=document.getElementById("programgroupHeaderList-txt_searchtext"),d=document.getElementById("programgroupHeaderList-btn_gridload");c.addEventListener("keydown",e=>{"enter"==e.key.toLowerCase()&&(e.stopPropagation(),d.click(),c.blur())});const u=a["headerList_initSearchParams"];"function"==typeof u&&u(e,p)}catch(e){throw e}finally{!0===t.autoLoadGridData&&f(e)}}async function f(e){await d.clear(),v(e)}function y(e,t){const o=c.SelectedRow;o.previousElementSibling?t.disablePrevButton(e,!1):t.disablePrevButton(e,!0),o.nextElementSibling?t.disableNextButton(e,!1):t.disableNextButton(e,!0)}function w(e,t){c.SelectedRow=t}async function b(e,t){const o=t.getAttribute("keyvalue"),r=t.getAttribute("key"),a=e.Modules.programgroupHeaderEdit;a.clearForm(e,"loading...");try{w(0,t),c.SelectedRow.keyValue=o,c.SelectedRow.key=r,await a.openSelectedData(e,{key:r,keyvalue:o})}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message),w(0,null),s.show()}y(e,a)}function E(e,t){const o=t.detail.tr;e.Modules.programgroupHeaderEdit.Section.show({},t=>{b(e,o)})}async function v(e,t={}){const{criteria:r={},limit:a=0,offset:n=0,sort:i={}}=t;for(var s in p){if(!p[s].validate())return console.error("ada yang belum diisi"),!1;r[s]=p[s].value}void 0===i&&(i=d.getSort());let c=$fgta5.Modal.createMask();try{const e=await async function(e,t,r,a,n){const i=`/${o.moduleName}/header-list`;try{const e=[];return await Module.apiCall(i,{columns:e,criteria:t,offset:r,limit:a,sort:n})}catch(e){throw e}}(0,r,n,a,i);0===n&&d.clear(),d.addRows(e.data),d.setNext(e.nextoffset,e.limit)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{c.close(),c=null}}var h=Object.freeze({__proto__:null,SearchParams:p,Section:g,addNewRow:function(e,t){w(e,d.addRow(t))},getCurrentRow:function(e){return c.SelectedRow},getGrid:function(e){return d},init:m,keyboardAction:function(e,t,o){if("up"==t)d.previousRecord();else if("down"==t)d.nextRecord();else if("enter"==t){e.Modules.programgroupHeaderEdit.Section.show({},()=>{b(e,d.CurrentRow)})}else if("typing"==t){o.preventDefault(),o.stopPropagation();const e=document.getElementById("programgroupHeaderList-txt_searchtext"),t=o.key;e.focus(),"Backspace"==t?Module.deleteAtCursor(e,"backspace"):"Delete"==t?Module.deleteAtCursor(e,"delete"):Module.insertAtCursor(e,o.key)}},loadData:f,removeCurrentRow:function(e){const t=c.SelectedRow;d.removeRow(t)},selectNextRow:function(e){const t=c.SelectedRow;t.nextElementSibling&&(d.CurrentRow=t.nextElementSibling,b(e,t.nextElementSibling))},selectPreviousRow:function(e){const t=c.SelectedRow;t.previousElementSibling&&(d.CurrentRow=t.previousElementSibling,b(e,t.previousElementSibling))},setPagingButton:y,updateCurrentRow:function(e,t){const o=c.SelectedRow;try{d.updateRow(o,t)}catch(e){throw e}}});const _={},L=o.Crsl,M=o.Sections.programgroupHeaderEdit,k=L.Items[M],S=o.Source,I="New Group Program",H="View Group Program",C="Edit Group Program",B="Edit",x="Lock",A=new $fgta5.ActionButton("programgroupHeaderEdit-btn_edit"),$=new $fgta5.ActionButton("programgroupHeaderEdit-btn_save"),R=new $fgta5.ActionButton("programgroupHeaderEdit-btn_new","programgroupHeader-new"),N=new $fgta5.ActionButton("programgroupHeaderEdit-btn_delete"),T=new $fgta5.ActionButton("programgroupHeaderEdit-btn_reset"),D=new $fgta5.ActionButton("programgroupHeaderEdit-btn_prev"),P=new $fgta5.ActionButton("programgroupHeaderEdit-btn_next"),K=document.getElementById("programgroupHeader-btn_recordstatus"),O=document.getElementById("programgroupHeader-btn_logs"),F=document.getElementById("programgroupHeader-btn_about"),j=new $fgta5.Form("programgroupHeaderEdit-frm");j.Inputs["programgroupHeaderEdit-obj_programgroup_id"],j.Inputs["programgroupHeaderEdit-obj_programgroup_isparent"],j.Inputs["programgroupHeaderEdit-obj_programgroup_name"];const G=j.Inputs["programgroupHeaderEdit-obj_programgroup_parent"];j.Inputs["programgroupHeaderEdit-obj_programgroup_descr"],j.Inputs["programgroupHeaderEdit-obj_programgroup_icon"],j.Inputs["programgroupHeaderEdit-obj_programgroup_level"],j.Inputs["programgroupHeaderEdit-obj_programgroup_pathid"],j.Inputs["programgroupHeaderEdit-obj_programgroup_path"];const U=document.getElementById("fRecord-section-createby"),q=document.getElementById("fRecord-section-createdate"),V=document.getElementById("fRecord-section-modifyby"),z=document.getElementById("fRecord-section-modifydate"),W=k;async function Z(t,r){k.addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{X()}),j.addEventListener("locked",e=>{!async function(e){k.Title=H,A.setText(B),A.disabled=!1,$.disabled=!0,R.disabled=!1,N.disabled=!0,T.disabled=!0,D.disabled=!1,P.disabled=!1;const t=a.programgroupHeaderEdit_formLocked;"function"==typeof t&&t(e,j,_);_.editDisabled&&(A.disabled=!0)}(t)}),j.addEventListener("unlocked",e=>{!async function(e){j.isNew()?k.Title=I:k.Title=C;A.setText(x),A.disabled=!1,$.disabled=!1,R.disabled=!0,N.disabled=!1,T.disabled=!1,D.disabled=!0,P.disabled=!0;const t=a.programgroupHeaderEdit_formUnlocked;"function"==typeof t&&t(e,j)}(t)}),j.render(),A.addEventListener("click",e=>{!async function(){if(j.isLocked())j.lock(!1);else{if(j.isChanged()||j.isNew())return void await $fgta5.MessageBox.warning(Module.EDIT_WARNING);j.lock(!0)}}()}),$.addEventListener("click",e=>{!async function(e){const t=a.programgroupHeaderEdit_autofill;"function"==typeof t&&await t(e,j);if(!j.validate()){const e=j.getLastError();return void $fgta5.MessageBox.warning(e)}let r;const n=j.isNew();if(n)r=j.getData();else{if(!j.isChanged())return;r=j.getDataChanged()}const i=a.programgroupHeaderEdit_dataSaving;"function"==typeof i&&await i(e,r,j);let s=null;const c=j.getFiles();if(null!=c){s=new FormData;for(let e in c){const t=c[e];s.append(e,t)}}let d=$fgta5.Modal.createMask();try{let t;t=n?await async function(e,t,r){const a=`/${o.moduleName}/header-create`;try{return await Module.apiCall(a,{data:t,source:S},r)}catch(e){throw e}}(0,r,s):await async function(e,t,r){const a=`/${o.moduleName}/header-update`;try{return await Module.apiCall(a,{data:t,source:S},r)}catch(e){throw e}}(0,r,s);const i=j.getPrimaryInput(),c=t[i.getBindingData()],d=await Q(e,c);_.currentOpenedId=c,j.AutoID?i.value=c:Y(e,{disabled:!0}),j.setData(d);const l=a["programgroupHeaderEdit_dataSaved"];"function"==typeof l&&await l(e,d,j),j.acceptChanges(),n?(A.disabled=!1,e.Modules.programgroupHeaderList.addNewRow(e,d)):e.Modules.programgroupHeaderList.updateCurrentRow(e,d)}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{d.close(),d=null}}(t)}),R.addEventListener("click",e=>{!async function(e,t){const o=t.target.getAttribute("data-sectionsource"),r=e.Modules.programgroupHeaderList,n=r.Section.Id,i=o===n;if(i)await k.show();else{let e=!1;if(j.isChanged()){"cancel"==await $fgta5.MessageBox.confirm(Module.NEWDATA_CONFIRM)&&(e=!0)}if(e)return}j.AutoID?Y(e,{disabled:!0,placeholder:"[AutoID]"}):Y(e,{disabled:!1,placeholder:"ID"});try{let t={programgroup_level:0};const o=a["programgroupHeaderEdit_newData"];"function"==typeof o&&await o(e,t,j),await J(e,t),j.lock(!1),A.disabled=!0,N.disabled=!0}catch(t){console.error(t),await $fgta5.MessageBox.error(t.message),i&&e.Modules.programgroupHeaderList.Section.show()}}(t,e)}),N.addEventListener("click",e=>{!async function(e){if(j.isNew())return;const t=j.getPrimaryInput().value;if("ok"!=await $fgta5.MessageBox.confirm(Module.DELETE_CONFIRM+`id: ${t}`))return;let r=$fgta5.Modal.createMask();try{await async function(e,t){const r=`/${o.moduleName}/header-delete`;try{return await Module.apiCall(r,{id:t,source:S})}catch(e){throw e}}(0,t);e.Modules.programgroupHeaderList.removeCurrentRow(e),e.Modules.programgroupHeaderList.Section.show(),j.lock()}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message)}finally{r.close(),r=null}}(t)}),T.addEventListener("click",e=>{!async function(){if(j.isNew())J();else if(j.isChanged()){if("ok"!=await $fgta5.MessageBox.confirm(Module.RESET_CONFIRM))return;j.reset()}}()}),D.addEventListener("click",e=>{!async function(e){e.Modules.programgroupHeaderList.selectPreviousRow(e)}(t)}),P.addEventListener("click",e=>{!async function(e){e.Modules.programgroupHeaderList.selectNextRow(e)}(t)}),K.addEventListener("click",r=>{!async function(t){const r={Context:o,sectionReturn:k};e.openSection(t,"fRecord-section",r,async()=>{let e=$fgta5.Modal.createMask();try{const e=j.getPrimaryInput().value,o=await Q(t,e);U.innerHTML=o._createby,q.innerHTML=o._createdate,V.innerHTML=o._modifyby,z.innerHTML=o._modifydate;const r=a["programgroupHeaderEdit_addRecordInfo"];"function"==typeof r&&await r(t,o)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{e.close(),e=null}})}(t)}),O.addEventListener("click",r=>{!async function(t){const r={Context:o,sectionReturn:k};e.openSection(t,"fLogs-section",r,async()=>{const t=j.getPrimaryInput().value;let r=$fgta5.Modal.createMask();try{const r=`${o.appsUrls.core.url}/logs/list`,a={module:o.moduleName,table:"core.programgroup",id:t},n=await Module.apiCall(r,{criteria:a}),i=document.getElementById("fLogs-section").querySelector("tbody");e.renderLog(i,n.data)}catch(e){console.error(e),$fgta5.MessageBox.error(e.message)}finally{r.close(),r=null}})}(t)}),F.addEventListener("click",r=>{!async function(t){const r={Context:o,sectionReturn:k};e.openSection(t,"fAbout-section",r,async()=>{L.Items["fAbout-section"].Title="About Group Program";const e=document.getElementById("fAbout-section");if(null==document.getElementById("fAbout-section-fdescr")){const t=document.createElement("div");t.setAttribute("id","fAbout-section-fdescr"),t.setAttribute("style","padding: 0 0 10px 0"),t.innerHTML="grouping program, untuk mengelompokkan program-program dalam hierarki";const o=e.querySelector("div[data-topbar]");o.parentNode.insertBefore(t,o.nextSibling)}if(null==document.getElementById("fAbout-section-footer")){const t=document.createElement("div");t.setAttribute("id","fAbout-section-footer"),t.setAttribute("style","border-top: 1px solid #ccc; padding: 5px 0 0 0; margin-top: 50px"),t.innerHTML="This module is generated by fgta5 generator at 11 Oct 2025 04:20",e.appendChild(t)}})}(t)}),G.addEventListener("selecting",async e=>{const r=a.obj_programgroup_parent_selecting;if("function"==typeof r)r(t,G,j,e);else{const r=e.detail.sender,i=e.detail.dialog,s=null!=e.detail.searchtext?e.detail.searchtext:"",c=`${o.appsUrls.core.url}/programgroup/header-list`,d={searchtext:s},l=a["obj_programgroup_parent_selecting_criteria"];"function"==typeof l&&l(t,G,d),r.wait();try{const t=await Module.apiCall(c,{criteria:d,offset:e.detail.offset,limit:e.detail.limit});for(var n of t.data)e.detail.addRow(n.programgroup_id,n.programgroup_name,n);i.setNext(t.nextoffset,t.limit)}catch(e){$fgta5.MessageBox.error(e.message)}finally{r.wait(!1)}}})}async function J(e,t){try{j.newData(t),j.acceptChanges(),j.setAsNewData()}catch(e){throw e}}async function Q(e,t){const r=`/${o.moduleName}/header-open`;try{return await Module.apiCall(r,{id:t})}catch(e){throw e}}async function X(e,t){let r=!1;j.isChanged()?"ok"==await $fgta5.MessageBox.confirm(Module.BACK_CONFIRM)&&(j.reset(),r=!0):r=!0;if(r){j.lock();const e=o.Sections.programgroupHeaderList;L.Items[e].show({direction:1})}}async function Y(e,t){const o=j.getPrimaryInput();o.disabled=!0===t.disabled,void 0!==t.placeholder&&(o.placeholder=t.placeholder),void 0!==t.value&&(o.value=t.value)}var ee=Object.freeze({__proto__:null,Section:W,clearForm:function(e,t){j.clear(t)},disableNextButton:function(e,t=!0){P.disabled=t},disablePrevButton:function(e,t=!0){D.disabled=t},getForm:function(e){return j},getHeaderForm:function(e){return j},init:Z,keyboardAction:function(e,t){"save"==t?(j.acceptInput(),$.click()):"new"==t?(j.acceptInput(),R.click()):"escape"==t?(j.acceptInput(),j.isLocked()||j.isNew()?X():A.click()):"togleEdit"==t?(j.acceptInput(),A.click()):"right"==t?P.click():"left"==t&&D.click()},openSelectedData:async function(e,t){let o=$fgta5.Modal.createMask();try{G.clear();const o=t.keyvalue,r=await Q(e,o);_.currentOpenedId=o;const n=a["programgroupHeaderEdit_isEditDisabled"];if("function"==typeof n){const t=n(e,r);_.editDisabled=t}Y(e,{disabled:!0}),j.setData(r),j.acceptChanges(),j.lock();const i=a["programgroupHeaderEdit_formOpened"];"function"==typeof i&&i(e,j,_)}catch(e){throw _.currentOpenedId=null,e}finally{o.close(),o=null}}});const te=o.app,oe=o.Crsl;class re extends Module{constructor(){super()}async main(e={}){te.setTitle("Group Program"),te.showFooter(!0),e.autoLoadGridData=!0;const t=this;t.Modules={programgroupHeaderList:h,programgroupHeaderEdit:ee};try{try{const e=await Module.apiCall(`/${o.moduleName}/init`,{});o.notifierId=e.notifierId,o.notifierSocket=e.notifierSocket,o.userId=e.userId,o.userFullname=e.userFullname,o.sid=e.sid,o.appsUrls=e.appsUrls}catch(e){throw e}await Promise.all([m(t,e),Z(t),r()]),await async function(e){try{const t=document.getElementsByClassName("footer-buttons-container");Module.renderFooterButtons(t),oe.setIconUrl(""),oe.addEventListener($fgta5.SectionCarousell.EVT_SECTIONSHOWING,e=>{var o=e.detail.commingSection.Id;for(let e of t){e.getAttribute("data-section")==o?setTimeout(()=>{e.classList.remove("hidden"),e.style.animation="dropped 0.3s forwards",setTimeout(()=>{e.style.animation="unset"},300)},500):e.classList.add("hidden")}}),oe.Items["fRecord-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()}),oe.Items["fLogs-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()}),oe.Items["fAbout-section"].addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async e=>{e.detail.fn_ShowNextSection()});document.getElementById("panel-detil-selector").querySelectorAll(".panel-detil-row a").forEach(t=>{t.addEventListener("mouseenter",()=>{t.closest(".panel-detil-row").classList.add("panel-detil-row-highligted")}),t.addEventListener("mouseleave",()=>{t.closest(".panel-detil-row").classList.remove("panel-detil-row-highligted")});const r=t.getAttribute("data-target-section"),a=t.getAttribute("data-current-section");t.addEventListener("click",t=>{!function(e,t,r){const a=o.Sections[r],n=oe.Items[a],i=o.Sections[t],s=oe.Items[i];s.setSectionReturn(n),s.show({},()=>{const o=e.Modules[t],a=e.Modules[r];o.openList(e,{moduleHeaderEdit:a})})}(e,r,a)})});const r=a["extendPage"];"function"==typeof r&&r(e)}catch(e){throw e}}(t),function(e){const t=/^[a-zA-Z0-9 ]$/;document.addEventListener("keydown",r=>{if(r.ctrlKey||r.metaKey||r.altKey);else if(t.test(r.key)||"Backspace"===r.key||"Delete"===r.key){const t=oe.CurrentSection.Id,a=o.SectionMap[t],n=e.Modules[a];ae(e,n,"typing",r)}},!0),document.addEventListener("keydown",t=>{const r=oe.CurrentSection.Id,a=o.SectionMap[r],n=e.Modules[a],i=document.querySelector("dialog[open]");if(i)return void("escape"==t.key.toLowerCase()?(i.close(),t.preventDefault()):(t.ctrlKey||t.metaKey)&&"s"===t.key.toLowerCase()&&t.preventDefault());const s=t.key.toLowerCase();(t.ctrlKey||t.metaKey)&&"s"===s?(t.preventDefault(),ae(e,n,"save",t)):(t.ctrlKey||t.metaKey)&&"n"===s||t.ctrlKey&&"f2"===s?(t.preventDefault(),ae(e,n,"new",t)):"escape"===s?(t.preventDefault(),ae(e,n,"escape",t)):"f2"===s?ae(e,n,"togleEdit",t):"arrowup"===s?ae(e,n,"up",t):"arrowdown"===s?ae(e,n,"down",t):"arrowright"===s?ae(e,n,"right",t):"arrowleft"===s?ae(e,n,"left",t):"enter"===s&&ae(e,n,"enter",t)})}(t);const n=["programgroupHeaderEdit"];window.onbeforeunload=e=>{let o=!1;for(var r of n){t.Modules[r].getForm(t).isChanged()&&(o=o||!0)}if(o)return e.preventDefault(),"Changes you made may not be saved."}}catch(e){throw e}}}function ae(e,t,o,r){null!=t?t.keyboardAction(e,o,r):"escape"==o&&oe.CurrentSection.back()}export{re as default};
